<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Purpose Quest Report</title>
    {% include '_common_head.html' %}
    <link rel="stylesheet" href="{{ url_for('static', filename='productStyle.css') }}">
</head>

<body class="d-flex flex-column min-vh-100">
    {% include 'header.html' %}

    <main class="container my-5 flex-grow-1">
        <section class="py-2">
            <div class="container">
                <div class="row">
                    <h3 class="w-100 text-center">Introduction</h3>
                    <div class="promo pe-md-3 pe-lg-5">
                        <p class="text-center">Welcome to your personalized evaluation report! This report is designed
                            to help you
                            understand the sources of meaning and purpose in your life based on your story. It is
                            inspired by the principles of Logotherapy, which focuses on finding meaning through
                            personal experiences, relationships, and values. You can use this report as a guide for
                            self-reflection and exploration, and it can also be integrated into your journaling
                            practice to deepen your understanding of yourself and your search for meaning.</p>
                    </div>
                </div>
            </div>
        </section>

        <div id="report-container"></div>

        <div id="report-data" data-report="{{ report_data }}"></div>
    </main>
    {% include 'account_footer.html' %}


    <script>
        function generateHtmlFromJson(jsonObject) {
            const htmlParts = [];
            let imageCounter = 1;
            let alternate = false;

            for (const [key, sectionData] of Object.entries(jsonObject)) {
                const sectionHeader = sectionData.Header ? `<h3 class="w-100">${sectionData.Header}</h3>` : '';
                const textContent = generateTextContent(sectionData, sectionHeader); // Pass the header to the textContent function
                const imageContent = generateImageContent(key, imageCounter);
                const sectionOrder = alternate ? textContent + imageContent : imageContent + textContent;

                htmlParts.push(`
            <section class="py-2">
                <div class="container">
                    <div class="row my-5">
                        ${sectionOrder}
                    </div>
                </div>
            </section>
        `);

                imageCounter++;
                alternate = !alternate;
            }

            return htmlParts.join('');
        }

        function generateTextContent(sectionData, sectionHeader) {
            let textContent = '';

            textContent += `<div class="col-12 col-md-7 align-self-center">`;
            if (sectionHeader) {
                textContent += `<h3 class="w-100">${sectionHeader.replace(/\n/g, '<br>')}</h3>`; // Replace \n with <br> in section header
            }
            textContent += `<div class="promo pe-md-3 pe-lg-5">`;
            for (const [innerKey, value] of Object.entries(sectionData)) {
                if (innerKey === 'Header') {
                    continue;
                } else if (innerKey === 'Content') {
                    if (Array.isArray(value)) {
                        for (const element of value) {
                            if (typeof element === 'string') {
                                textContent += `<p>${element.replace(/\n/g, '<br>')}</p>`; // Replace \n with <br> in strings
                            } else if (typeof element === 'object') {
                                textContent += generateSectionHtml(element);
                            }
                        }
                    } else {
                        textContent += `<p>${value.replace(/\n/g, '<br>')}</p>`; // Replace \n with <br> in strings
                    }
                } else if (innerKey === 'Topics' || innerKey === 'Points') {
                    for (const topic of value) {
                        textContent += generateSectionHtml(topic);
                    }
                } else if (typeof value === 'object') {
                    textContent += generateSectionHtml(value);
                }
            }
            textContent += `</div></div>`; // Closing divs for promo and column

            return textContent;
        }

        function generateImageContent(key, imageCounter) {
            let imageContent = '';

            imageContent += `<div class="col-12 col-md-5 align-self-center">`;
            imageContent += `<div class="product-cover-holder text-center">`;
            imageContent += `<img class="img-fluid rounded report-img product-cover" src="/static/images/purpose-quest-${imageCounter}.png" alt="${key} cover">`;
            imageContent += `</div></div>`; // Closing divs for product-cover-holder and column

            return imageContent;
        }

        function generateSectionHtml(data) {
            let html = '';
            if (data.Header) {
                html += `<h6>${data.Header.replace(/\n/g, '<br>')}</h6>`; // Replace \n with <br> in subheaders
            }
            if (data.Content) {
                if (typeof data.Content === 'string') {
                    html += `<p>${data.Content.replace(/\n/g, '<br>')}</p>`; // Handle strings
                } else if (typeof data.Content === 'object') {
                    // Check if it's a simple object or a nested structure
                    if (Object.values(data.Content).every(value => typeof value === 'string')) {
                        // Handle as a bulleted list if all values are strings
                        html += `<ul>`;
                        Object.entries(data.Content).forEach(([key, value]) => {
                            html += `<li><strong>${key.replace(/([A-Z])/g, ' $1').trim()}: </strong>${value.replace(/\n/g, '<br>')}</li>`;
                        });
                        html += `</ul>`;
                    } else {
                        // Recursively handle nested objects
                        Object.entries(data.Content).forEach(([key, value]) => {
                            if (typeof value === 'object') {
                                // For nested objects, call generateSectionHtml recursively
                                html += `<strong>${key.replace(/([A-Z])/g, ' $1').trim()}:</strong>`;
                                html += generateSectionHtml({ Content: value });
                            } else {
                                // For strings, format directly
                                html += `<p>${key.replace(/([A-Z])/g, ' $1').trim()}: ${value.replace(/\n/g, '<br>')}</p>`;
                            }
                        });
                    }
                }
            }
            return html;
        }


        const rawData = document.getElementById('report-data').getAttribute('data-report');
        const reportJson = JSON.parse(rawData);
        // console.log(reportJson)
        // console.log(rawData)
        const reportHtml = generateHtmlFromJson(reportJson);
        document.getElementById('report-container').innerHTML = reportHtml;

    </script>
</body>


</html>